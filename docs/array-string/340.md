# [340. Longest Substring with At Most K Distinct Characters](https://leetcode.com/problems/longest-substring-with-at-most-k-distinct-characters/description/) <Badge type="warning" text="Medium" />

Given a string <code>s</code> and an integer <code>k</code>, return the length of the longest substring of <code>s</code> that contains at most <code>k</code> distinct characters.

**Example 1:**

```
Input: s = "eceba", k = 2
Output: 3
Explanation: The substring is "ece" which has 2 distinct characters.
```

**Example 2:**

```
Input: s = "aa", k = 1
Output: 2
Explanation: The substring is "aa".
```

**Constraints:**

- <code>1 <= s.length <= 5 * 10^4</code>
- <code>0 <= k <= 50</code>

## Approach: Sliding Window + Hash Map

1. Maintain a window <code>[left, right]</code> and a map (or counter) of character frequencies in the window.
2. Expand by moving <code>right</code>, add <code>s[right]</code> to the map.
3. While the number of distinct characters in the map exceeds <code>k</code>, shrink from the left: decrement <code>s[left]</code> in the map, remove key if count becomes 0, then <code>left++</code>.
4. After each step, the window has at most <code>k</code> distinct characters; update the maximum length.
5. Return the maximum length.

## Code

::: code-group

```typescript [TypeScript]
function lengthOfLongestSubstringKDistinct(s: string, k: number): number {
    if (k === 0) return 0;
    const count = new Map<string, number>();
    let left = 0;
    let maxLen = 0;
    for (let right = 0; right < s.length; right++) {
        count.set(s[right], (count.get(s[right]) ?? 0) + 1);
        while (count.size > k) {
            count.set(s[left], count.get(s[left])! - 1);
            if (count.get(s[left]) === 0) count.delete(s[left]);
            left++;
        }
        maxLen = Math.max(maxLen, right - left + 1);
    }
    return maxLen;
}
```

```kotlin [Kotlin]
class Solution {
    fun lengthOfLongestSubstringKDistinct(s: String, k: Int): Int {
        if (k == 0) return 0
        val count = mutableMapOf<Char, Int>()
        var left = 0
        var maxLen = 0
        for (right in s.indices) {
            count[s[right]] = count.getOrDefault(s[right], 0) + 1
            while (count.size > k) {
                count[s[left]] = count[s[left]]!! - 1
                if (count[s[left]] == 0) count.remove(s[left])
                left++
            }
            maxLen = maxOf(maxLen, right - left + 1)
        }
        return maxLen
    }
}
```

```java [Java]
class Solution {
    public int lengthOfLongestSubstringKDistinct(String s, int k) {
        if (k == 0) return 0;
        Map<Character, Integer> count = new HashMap<>();
        int left = 0;
        int maxLen = 0;
        for (int right = 0; right < s.length(); right++) {
            count.put(s.charAt(right), count.getOrDefault(s.charAt(right), 0) + 1);
            while (count.size() > k) {
                count.put(s.charAt(left), count.get(s.charAt(left)) - 1);
                if (count.get(s.charAt(left)) == 0) count.remove(s.charAt(left));
                left++;
            }
            maxLen = Math.max(maxLen, right - left + 1);
        }
        return maxLen;
    }
}
```

```swift [Swift]
class Solution {
    func lengthOfLongestSubstringKDistinct(_ s: String, _ k: Int) -> Int {
        if k == 0 || s.isEmpty {
            return 0
        }

        let chars = Array(s)
        var counts: [Character: Int] = [:]
        var left = 0
        var best = 0

        for right in 0..<chars.count {
            counts[chars[right], default: 0] += 1

            while counts.count > k {
                let ch = chars[left]
                if let value = counts[ch] {
                    if value == 1 {
                        counts.removeValue(forKey: ch)
                    } else {
                        counts[ch] = value - 1
                    }
                }
                left += 1
            }

            best = max(best, right - left + 1)
        }

        return best
    }
}
```

```python [Python]
class Solution:
    def lengthOfLongestSubstringKDistinct(self, s: str, k: int) -> int:
        if k == 0:
            return 0
        count: dict[str, int] = {}
        left = 0
        max_len = 0
        for right in range(len(s)):
            count[s[right]] = count.get(s[right], 0) + 1
            while len(count) > k:
                count[s[left]] -= 1
                if count[s[left]] == 0:
                    del count[s[left]]
                left += 1
            max_len = max(max_len, right - left + 1)
        return max_len
```

:::
## Complexity

- **Time Complexity:** O(n)
- **Space Complexity:** O(k)
